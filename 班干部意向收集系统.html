<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç­å¹²éƒ¨æ„å‘æ”¶é›†ç³»ç»Ÿ - å›­æ—æ™¯åŒºä¸»é¢˜</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Serif+SC:wght@400;700&display=swap">
    <style>
        /* å®Œæ•´CSSæ ·å¼ï¼Œä¿æŒåŸæ · */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #f5f7f2;
            color: #333;
            line-height: 1.6;
            background-image: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path d="M10,10 C20,5 40,15 50,10 C60,5 80,15 90,10 L90,90 C80,85 60,95 50,90 C40,85 20,95 10,90 Z" fill="%23e8f4e8" opacity="0.3"/><circle cx="30" cy="30" r="8" fill="%23c8e6c9" opacity="0.4"/><circle cx="70" cy="70" r="6" fill="%23a5d6a7" opacity="0.4"/><circle cx="20" cy="60" r="5" fill="%2381c784" opacity="0.4"/></svg>');
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* å›­æ—ä¸»é¢˜è£…é¥° */
        .garden-decoration {
            position: fixed;
            z-index: -1;
            opacity: 0.15;
        }
        
        .garden-decoration.top-left {
            top: 0;
            left: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #8bc34a 0%, transparent 70%);
        }
        
        .garden-decoration.top-right {
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, #4caf50 0%, transparent 70%);
        }
        
        .garden-decoration.bottom-left {
            bottom: 0;
            left: 0;
            width: 250px;
            height: 250px;
            background: radial-gradient(circle, #689f38 0%, transparent 70%);
        }
        
        .garden-decoration.bottom-right {
            bottom: 0;
            right: 0;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #388e3c 0%, transparent 70%);
        }
        
        /* é¡¶éƒ¨å›­æ—é£æ ¼æ ‡é¢˜ */
        .garden-header {
            background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%);
            color: white;
            padding: 40px 0;
            border-radius: 16px;
            text-align: center;
            margin-bottom: 40px;
            box-shadow: 0 10px 25px rgba(46, 125, 50, 0.2);
            position: relative;
            overflow: hidden;
            border: 8px solid #c8e6c9;
        }
        
        .garden-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 10px;
            background: linear-gradient(90deg, #ff9800, #ffeb3b, #4caf50, #2196f3, #9c27b0);
        }
        
        .garden-header::after {
            content: "ğŸŒ³ ğŸ¯ ğŸ‹ ğŸŒ¸";
            position: absolute;
            bottom: 10px;
            right: 20px;
            font-size: 24px;
            opacity: 0.3;
        }
        
        .header-title {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 3.2rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: 3px;
        }
        
        .header-subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
            padding: 0 20px;
        }
        
        .header-subtitle::before, .header-subtitle::after {
            content: "âœ¿";
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5rem;
            opacity: 0.7;
        }
        
        .header-subtitle::before {
            left: 0;
        }
        
        .header-subtitle::after {
            right: 0;
        }
        
        .role-switch {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .role-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 18px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .role-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .role-btn.active {
            background: white;
            color: #1b5e20;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }
        
        /* å›­æ—é£æ ¼å¡ç‰‡ */
        .garden-card {
            background-color: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.1);
            margin-bottom: 30px;
            border: 2px solid #c8e6c9;
            position: relative;
            overflow: hidden;
        }
        
        .garden-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, #4caf50, #8bc34a, #cddc39);
        }
        
        .section-title {
            font-size: 1.8rem;
            color: #1b5e20;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e8f5e9;
            display: flex;
            align-items: center;
            position: relative;
        }
        
        .section-title i {
            margin-right: 12px;
            color: #4caf50;
        }
        
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 80px;
            height: 2px;
            background: linear-gradient(90deg, #4caf50, #8bc34a);
        }
        
        /* å²—ä½å¡ç‰‡è®¾è®¡ */
        .positions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .position-card {
            background-color: #f9fdf8;
            border-radius: 12px;
            padding: 20px;
            border: 2px solid #e8f5e9;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .position-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 25px rgba(76, 175, 80, 0.15);
            border-color: #4caf50;
        }
        
        .position-card::before {
            content: "ğŸŒ¿";
            position: absolute;
            top: 10px;
            right: 10px;
            opacity: 0.2;
            font-size: 1.5rem;
        }
        
        .position-card h3 {
            font-size: 1.3rem;
            color: #1b5e20;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .position-card p {
            font-size: 0.95rem;
            color: #666;
            margin-bottom: 15px;
        }
        
        .applicant-count {
            position: absolute;
            top: 15px;
            right: 15px;
            background: #4caf50;
            color: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .role-badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }
        
        .important-role {
            background-color: #fff3e0;
            color: #e65100;
            border: 1px solid #ffcc80;
        }
        
        .special-role {
            background-color: #f3e5f5;
            color: #7b1fa2;
            border: 1px solid #e1bee7;
        }
        
        .academic-role {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .manage-role {
            background-color: #e0f2f1;
            color: #00695c;
            border: 1px solid #b2dfdb;
        }
        
        .custom-role {
            background-color: #fff8e1;
            color: #ff8f00;
            border: 1px solid #ffd54f;
        }
        
        /* è¡¨å•è®¾è®¡ */
        .form-group {
            margin-bottom: 25px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #1b5e20;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #c8e6c9;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
            background-color: #f9fdf8;
            font-family: 'Noto Serif SC', serif;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #4caf50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
            background-color: white;
        }
        
        .priority-group {
            display: flex;
            gap: 15px;
        }
        
        @media (max-width: 768px) {
            .priority-group {
                flex-direction: column;
            }
        }
        
        .priority-item {
            flex: 1;
        }
        
        .priority-item label {
            font-size: 0.95rem;
            font-weight: normal;
        }
        
        /* è‡ªå®šä¹‰å²—ä½éƒ¨åˆ† */
        .custom-position-toggle {
            display: flex;
            align-items: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #f0f9f0;
            border-radius: 10px;
            border: 2px dashed #a5d6a7;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .custom-position-toggle:hover {
            background-color: #e8f5e9;
            border-color: #4caf50;
        }
        
        .custom-position-toggle i {
            font-size: 1.5rem;
            color: #4caf50;
            margin-right: 15px;
        }
        
        .custom-position-form {
            display: none;
            padding: 20px;
            background-color: #f9fdf8;
            border-radius: 10px;
            border: 2px solid #c8e6c9;
            margin-top: 10px;
        }
        
        .custom-position-form.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .custom-position-badge {
            display: inline-flex;
            align-items: center;
            padding: 8px 15px;
            background-color: #fff8e1;
            color: #ff8f00;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin-left: 10px;
            border: 1px solid #ffd54f;
        }
        
        .custom-position-badge i {
            margin-right: 5px;
        }
        
        /* æŒ‰é’®è®¾è®¡ */
        .btn {
            display: inline-block;
            background: linear-gradient(135deg, #4caf50 0%, #2e7d32 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
            font-family: 'Noto Serif SC', serif;
            position: relative;
            overflow: hidden;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.3);
            transform: translateY(-3px);
        }
        
        .btn::after {
            content: "";
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }
        
        .btn:hover::after {
            left: 100%;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #78909c 0%, #546e7a 100%);
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #546e7a 0%, #78909c 100%);
            box-shadow: 0 8px 20px rgba(84, 110, 122, 0.3);
        }
        
        .btn-small {
            width: auto;
            padding: 10px 20px;
            font-size: 1rem;
            margin-top: 0;
        }
        
        /* ç™»å½•ç•Œé¢ */
        .login-container {
            max-width: 500px;
            margin: 60px auto;
        }
        
        .login-card {
            background-color: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(46, 125, 50, 0.15);
            border: 3px solid #c8e6c9;
            position: relative;
            overflow: hidden;
        }
        
        .login-card::before {
            content: "ğŸ‹";
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            opacity: 0.1;
        }
        
        .login-title {
            text-align: center;
            font-size: 2.2rem;
            color: #1b5e20;
            margin-bottom: 30px;
            font-family: 'Ma Shan Zheng', cursive;
        }
        
        .login-icon {
            text-align: center;
            font-size: 3rem;
            margin-bottom: 20px;
            color: #4caf50;
        }
        
        /* é€‰é¡¹å¡è®¾è®¡ */
        .tab-container {
            margin-bottom: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 2px solid #e8f5e9;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 14px 24px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #4caf50;
        }
        
        .tab.active {
            color: #1b5e20;
            border-bottom: 3px solid #4caf50;
        }
        
        .tab-content {
            display: none;
            padding-top: 10px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* ç”³è¯·è€…åˆ—è¡¨ */
        .applicants-list {
            margin-top: 20px;
            display: none;
        }
        
        .applicants-list.active {
            display: block;
        }
        
        .applicant-item {
            background-color: #f9fdf8;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: 2px solid #e8f5e9;
            position: relative;
            transition: all 0.3s;
        }
        
        .applicant-item:hover {
            border-color: #4caf50;
            transform: translateX(5px);
        }
        
        .applicant-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .applicant-name {
            font-weight: bold;
            color: #1b5e20;
            font-size: 1.1rem;
        }
        
        .applicant-priorities span {
            display: inline-block;
            margin-right: 10px;
            padding: 4px 10px;
            background-color: #e8f5e9;
            border-radius: 6px;
            font-size: 0.85rem;
        }
        
        .applicant-priorities .priority1 {
            background-color: #fff3e0;
            color: #e65100;
        }
        
        .applicant-experience {
            font-size: 0.95rem;
            color: #666;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed #c8e6c9;
        }
        
        /* æˆ‘çš„ç”³è¯· */
        .my-application-item {
            background-color: #f9fdf8;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            border: 2px solid #e8f5e9;
            position: relative;
        }
        
        .my-application-item::before {
            content: "ğŸŒ¸";
            position: absolute;
            top: 15px;
            right: 15px;
            opacity: 0.3;
        }
        
        .my-application-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .my-application-status {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        
        .status-reviewed {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        /* ä¿®æ”¹å¯†ç é¢æ¿ */
        .change-password-panel {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px dashed #c8e6c9;
        }
        
        /* é¡µè„šè®¾è®¡ */
        .garden-footer {
            text-align: center;
            margin-top: 60px;
            padding: 30px 0;
            border-top: 2px solid #c8e6c9;
            color: #666;
            font-size: 0.95rem;
            position: relative;
        }
        
        .garden-footer::before {
            content: "ğŸ ğŸ® ğŸ ğŸŒ±";
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: #f5f7f2;
            padding: 0 20px;
        }
        
        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid #e8f5e9;
            border-top: 6px solid #4caf50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-left: 20px;
            font-size: 1.2rem;
            color: #1b5e20;
            font-family: 'Noto Serif SC', serif;
        }
        
        /* æç¤ºæ¶ˆæ¯æ ·å¼ */
        .toast-message {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 25px;
            background: #1b5e20;
            color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            z-index: 9998;
            display: none;
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1000px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header-title {
                font-size: 2.5rem;
            }
            
            .positions-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .header-title {
                font-size: 2rem;
            }
            
            .positions-grid {
                grid-template-columns: 1fr;
            }
            
            .role-switch {
                position: relative;
                top: 0;
                right: 0;
                justify-content: center;
                margin-top: 20px;
            }
            
            .applicant-header {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        /* éšè—/æ˜¾ç¤ºé¢æ¿ */
        .admin-panel, .student-panel, .login-panel {
            display: none;
        }
        
        .active-panel {
            display: block;
        }
        
        /* å›­æ—å›¾æ ‡è£…é¥° */
        .garden-icon {
            font-size: 1.2rem;
            margin-right: 8px;
        }
        
        /* è‡ªå®šä¹‰å²—ä½æŒ‡ç¤ºå™¨ */
        .custom-indicator {
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
            color: #ff8f00;
            font-size: 0.9rem;
        }
        
        .custom-indicator i {
            margin-right: 5px;
        }
        
        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #888;
            font-style: italic;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #c8e6c9;
        }
        
        /* è‡ªå®šä¹‰å²—ä½åˆ—è¡¨ */
        .custom-positions-list {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9fdf8;
            border-radius: 10px;
            border: 2px dashed #ffd54f;
        }
        
        .custom-position-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #fff8e1;
            border-radius: 8px;
            border: 1px solid #ffd54f;
        }
        
        .custom-position-name {
            font-weight: bold;
            color: #ff8f00;
        }
        
        .custom-position-description {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* ç½‘ç»œçŠ¶æ€æŒ‡ç¤ºå™¨ */
        .sync-status {
            position: absolute;
            bottom: 15px;
            left: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px 12px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }
        
        .sync-queue-count {
            background: #ff9800;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        
        /* ç­çº§ç®¡ç†é¢æ¿ */
        .class-manage-panel {
            margin-top: 30px;
            padding: 20px;
            background-color: #e8f5e9;
            border-radius: 12px;
            border: 2px solid #c8e6c9;
        }
        
        .class-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .class-info-item {
            flex: 1;
            min-width: 200px;
        }
        
        .class-code-box {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px dashed #4caf50;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .class-code {
            font-size: 2rem;
            font-weight: bold;
            color: #1b5e20;
            margin: 10px 0;
            letter-spacing: 3px;
        }
        
        .invite-link {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .invite-link input {
            flex: 1;
            font-family: monospace;
            background: #f5f5f5;
        }
        
        /* äºŒç»´ç  */
        .qr-code-container {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #c8e6c9;
        }
        
        .qr-code {
            width: 150px;
            height: 150px;
            margin: 0 auto 15px;
            background: #f5f5f5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #4caf50;
            border-radius: 10px;
        }
        
        /* åˆ†äº«æŒ‰é’® */
        .share-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
        }
        
        .share-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .share-btn:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }
        
        /* å…¬å‘Šæ¿ */
        .announcement-board {
            margin: 30px 0;
            padding: 25px;
            background: linear-gradient(135deg, #fff9c4 0%, #fff59d 100%);
            border-radius: 12px;
            border: 2px solid #ffd54f;
        }
        
        .announcement-title {
            color: #ff8f00;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* ç»Ÿè®¡æ•°æ®å¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #c8e6c9;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1b5e20;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* æ—¶é—´è½´ */
        .timeline {
            position: relative;
            padding-left: 30px;
            margin: 20px 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #c8e6c9;
        }
        
        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            padding: 15px;
            background: white;
            border-radius: 8px;
            border: 2px solid #e8f5e9;
        }
        
        .timeline-item::before {
            content: '';
            position: absolute;
            left: -23px;
            top: 20px;
            width: 12px;
            height: 12px;
            background: #4caf50;
            border-radius: 50%;
            border: 3px solid white;
        }
        
        /* ç­çº§é€‰æ‹©å™¨ */
        .class-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .class-option {
            padding: 10px 20px;
            background: #f5f5f5;
            border: 2px solid #c8e6c9;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .class-option:hover {
            background: #e8f5e9;
        }
        
        .class-option.active {
            background: #4caf50;
            color: white;
            border-color: #388e3c;
        }
    </style>
</head>
<body>
    <!-- åŠ è½½é®ç½©å±‚ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">æ•°æ®åŠ è½½ä¸­... è¯·ç¨å€™</div>
    </div>
    
    <!-- æç¤ºæ¶ˆæ¯ -->
    <div class="toast-message" id="toastMessage"></div>
    
    <!-- å›­æ—è£…é¥°å…ƒç´  -->
    <div class="garden-decoration top-left"></div>
    <div class="garden-decoration top-right"></div>
    <div class="garden-decoration bottom-left"></div>
    <div class="garden-decoration bottom-right"></div>
    
    <div class="container">
        <!-- ç™»å½•ç•Œé¢ -->
        <div class="login-panel active-panel" id="loginPanel">
            <div class="login-container">
                <div class="login-card">
                    <div class="login-icon">
                        <i class="fas fa-tree"></i>
                    </div>
                    <h2 class="login-title">ç­å¹²éƒ¨æ„å‘æ”¶é›†ç³»ç»Ÿ</h2>
                    
                    <div class="tab-container">
                        <div class="tabs">
                            <div class="tab active" data-tab="login">ç™»å½•</div>
                            <div class="tab" data-tab="register">æ³¨å†Œç­çº§</div>
                            <div class="tab" data-tab="join">åŠ å…¥ç­çº§</div>
                        </div>
                        
                        <!-- ç™»å½•æ ‡ç­¾é¡µ -->
                        <div class="tab-content active" id="login-tab">
                            <div class="form-group">
                                <label for="loginClassCode"><i class="fas fa-school garden-icon"></i> ç­çº§ä»£ç </label>
                                <input type="text" id="loginClassCode" placeholder="è¯·è¾“å…¥ç­çº§ä»£ç ">
                            </div>
                            
                            <div class="form-group">
                                <label for="loginUsername"><i class="fas fa-user garden-icon"></i> èº«ä»½</label>
                                <select id="loginUsername" class="login-input">
                                    <option value="">è¯·é€‰æ‹©ç™»å½•èº«ä»½</option>
                                    <option value="student">å­¦ç”Ÿ</option>
                                    <option value="teacher">ç­ä¸»ä»»</option>
                                </select>
                            </div>
                            
                            <div class="form-group" id="studentIdGroup">
                                <label for="studentId"><i class="fas fa-id-card garden-icon"></i> å­¦å·/å§“å</label>
                                <input type="text" id="studentId" placeholder="è¯·è¾“å…¥å­¦å·æˆ–å§“å" class="login-input">
                            </div>
                            
                            <div class="form-group" id="teacherPasswordGroup" style="display: none;">
                                <label for="teacherPassword"><i class="fas fa-lock garden-icon"></i> å¯†ç </label>
                                <input type="password" id="teacherPassword" placeholder="è¯·è¾“å…¥ç­ä¸»ä»»å¯†ç " class="login-input">
                            </div>
                            
                            <button class="btn" id="loginBtn">
                                <i class="fas fa-sign-in-alt"></i> ç™»å½•
                            </button>
                        </div>
                        
                        <!-- æ³¨å†Œç­çº§æ ‡ç­¾é¡µ -->
                        <div class="tab-content" id="register-tab">
                            <div class="form-group">
                                <label for="teacherName"><i class="fas fa-user-tie garden-icon"></i> ç­ä¸»ä»»å§“å</label>
                                <input type="text" id="teacherName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                            </div>
                            
                            <div class="form-group">
                                <label for="className"><i class="fas fa-graduation-cap garden-icon"></i> ç­çº§åç§°</label>
                                <input type="text" id="className" placeholder="ä¾‹å¦‚ï¼šé«˜ä¸‰(1)ç­">
                            </div>
                            
                            <div class="form-group">
                                <label for="teacherEmail"><i class="fas fa-envelope garden-icon"></i> é‚®ç®±ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="email" id="teacherEmail" placeholder="ç”¨äºæ¥æ”¶é€šçŸ¥">
                            </div>
                            
                            <div class="form-group">
                                <label for="registerPassword"><i class="fas fa-lock garden-icon"></i> è®¾ç½®å¯†ç </label>
                                <input type="password" id="registerPassword" placeholder="è®¾ç½®ç­ä¸»ä»»ç™»å½•å¯†ç ">
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword"><i class="fas fa-lock garden-icon"></i> ç¡®è®¤å¯†ç </label>
                                <input type="password" id="confirmPassword" placeholder="è¯·å†æ¬¡è¾“å…¥å¯†ç ">
                            </div>
                            
                            <button class="btn" id="registerBtn">
                                <i class="fas fa-plus-circle"></i> åˆ›å»ºç­çº§
                            </button>
                        </div>
                        
                        <!-- åŠ å…¥ç­çº§æ ‡ç­¾é¡µ -->
                        <div class="tab-content" id="join-tab">
                            <div class="form-group">
                                <label for="joinClassCode"><i class="fas fa-school garden-icon"></i> ç­çº§ä»£ç </label>
                                <input type="text" id="joinClassCode" placeholder="è¯·è¾“å…¥ç­çº§ä»£ç ">
                            </div>
                            
                            <div class="form-group">
                                <label for="joinStudentName"><i class="fas fa-user garden-icon"></i> å­¦ç”Ÿå§“å</label>
                                <input type="text" id="joinStudentName" placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                            </div>
                            
                            <div class="form-group">
                                <label for="joinStudentId"><i class="fas fa-id-card garden-icon"></i> å­¦å·ï¼ˆå¯é€‰ï¼‰</label>
                                <input type="text" id="joinStudentId" placeholder="è¯·è¾“å…¥å­¦å·ï¼ˆå¯é€‰ï¼‰">
                            </div>
                            
                            <button class="btn" id="joinBtn">
                                <i class="fas fa-user-plus"></i> åŠ å…¥ç­çº§
                            </button>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: center; color: #666; font-size: 0.9rem;">
                        <p>ğŸŒ¿ æ¬¢è¿ä½¿ç”¨ç­å¹²éƒ¨æ„å‘æ”¶é›†ç³»ç»Ÿ ğŸŒ¿</p>
                        <p>æ”¯æŒå¤šç­çº§ç®¡ç†ï¼Œæ•°æ®äº‘ç«¯åŒæ­¥</p>
                        <p>ç­ä¸»ä»»å¯åˆ›å»ºç­çº§ï¼Œå­¦ç”Ÿä½¿ç”¨ç­çº§ä»£ç åŠ å…¥</p>
                        <div style="margin-top: 15px; padding: 10px; background: #e8f5e9; border-radius: 8px;">
                            <p><strong>æ¼”ç¤ºä¿¡æ¯ï¼š</strong></p>
                            <p>ç­çº§ä»£ç : <span style="color: #1b5e20; font-weight: bold;">DEMO123</span></p>
                            <p>å­¦ç”Ÿ: ä»»æ„å§“å</p>
                            <p>ç­ä¸»ä»»å¯†ç : <span style="color: #1b5e20; font-weight: bold;">123456</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ç³»ç»Ÿä¸»ç•Œé¢ -->
        <div id="mainSystem" style="display: none;">
            <!-- å›­æ—é£æ ¼å¤´éƒ¨ -->
            <header class="garden-header">
                <div class="role-switch">
                    <button class="role-btn active" id="studentBtn">
                        <i class="fas fa-user-graduate"></i> å­¦ç”Ÿç«¯
                    </button>
                    <button class="role-btn" id="teacherBtn">
                        <i class="fas fa-chalkboard-teacher"></i> ç­ä¸»ä»»ç«¯
                    </button>
                    <button class="role-btn" id="manageBtn">
                        <i class="fas fa-cog"></i> ç­çº§ç®¡ç†
                    </button>
                    <button class="role-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> é€€å‡º
                    </button>
                </div>
                <h1 class="header-title" id="classTitle">ç­å¹²éƒ¨æ„å‘æ”¶é›†ç³»ç»Ÿ</h1>
                <p class="header-subtitle" id="classSubtitle">åº­å›­æ·±æ·±æ·±å‡ è®¸ï¼Œç­å¹²é€‰æ‹”èšç¾¤è‹±</p>
                <div class="sync-status" id="syncStatus">
                    <i class="fas fa-wifi" style="color: #4caf50;"></i>
                    <span>åœ¨çº¿</span>
                    <span id="syncQueueCount" class="sync-queue-count" style="display: none;"></span>
                </div>
            </header>
            
            <!-- å…¬å‘Šæ¿ -->
            <div class="announcement-board" id="announcementBoard">
                <h3 class="announcement-title"><i class="fas fa-bullhorn"></i> å…¬å‘Š</h3>
                <div id="announcementContent">
                    æ¬¢è¿ä½¿ç”¨ç­å¹²éƒ¨æ„å‘æ”¶é›†ç³»ç»Ÿï¼è¯·åŒå­¦ä»¬åœ¨è§„å®šæ—¶é—´å†…æäº¤æ„å‘ç”³è¯·ã€‚
                </div>
            </div>
            
            <!-- ç»Ÿè®¡æ•°æ® -->
            <div class="garden-card" id="statsCard" style="display: none;">
                <h2 class="section-title"><i class="fas fa-chart-line"></i> ç­çº§ç»Ÿè®¡</h2>
                <div class="stats-grid" id="statsGrid">
                    <!-- ç»Ÿè®¡æ•°æ®åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- å­¦ç”Ÿç«¯ç•Œé¢ -->
            <div class="student-panel active-panel" id="studentPanel">
                <div class="garden-card">
                    <h2 class="section-title"><i class="fas fa-list-ol"></i> ç­å¹²éƒ¨å²—ä½æ„å‘å¡«æŠ¥</h2>
                    <p style="margin-bottom: 20px; color: #666;">è¯·æ ¹æ®è‡ªèº«å…´è¶£ä¸èƒ½åŠ›ï¼Œåœ¨ä¸‹æ–¹å›­æ—ä¸­é€‰æ‹©å¿ƒä»ªçš„å²—ä½ï¼Œæ¯äººå¯å¡«æŠ¥ä¸‰ä¸ªå¿—æ„¿ã€‚æ‚¨å¯ä»¥é€‰æ‹©ç°æœ‰å²—ä½ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å²—ä½æ„å‘ã€‚</p>
                    
                    <div class="tab-container">
                        <div class="tabs">
                            <div class="tab active" data-tab="important">ğŸ¯ é‡è¦å²—ä½</div>
                            <div class="tab" data-tab="special">ğŸ‹ ä¸“é¡¹å²—ä½</div>
                            <div class="tab" data-tab="academic">ğŸ“š å­¦ç§‘å²—ä½</div>
                            <div class="tab" data-tab="manage">ğŸ”‘ æ‰¿åŒ…ç®¡ç†</div>
                            <div class="tab" data-tab="custom">âœ¨ è‡ªå®šä¹‰å²—ä½</div>
                        </div>
                        
                        <div class="tab-content active" id="important-tab">
                            <div class="positions-grid" id="importantPositions">
                                <!-- é‡è¦å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <div class="tab-content" id="special-tab">
                            <div class="positions-grid" id="specialPositions">
                                <!-- ä¸“é¡¹å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <div class="tab-content" id="academic-tab">
                            <div class="positions-grid" id="academicPositions">
                                <!-- å­¦ç§‘å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <div class="tab-content" id="manage-tab">
                            <div class="positions-grid" id="managePositions">
                                <!-- æ‰¿åŒ…ç®¡ç†å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                        </div>
                        
                        <div class="tab-content" id="custom-tab">
                            <div class="custom-positions-list" id="customPositionsList">
                                <!-- è‡ªå®šä¹‰å²—ä½åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                            </div>
                            
                            <div class="custom-position-toggle" id="customPositionToggle">
                                <i class="fas fa-plus-circle"></i>
                                <div>
                                    <h3 style="color: #1b5e20; margin-bottom: 5px;">æ·»åŠ è‡ªå®šä¹‰å²—ä½æ„å‘</h3>
                                    <p style="color: #666; font-size: 0.95rem;">å¦‚æœæ‚¨æœ‰ç‹¬ç‰¹çš„ç­çº§ç®¡ç†æƒ³æ³•ï¼Œå¯ä»¥åœ¨æ­¤æ·»åŠ è‡ªå®šä¹‰å²—ä½</p>
                                </div>
                            </div>
                            
                            <div class="custom-position-form" id="customPositionForm">
                                <div class="form-group">
                                    <label for="customPositionName"><i class="fas fa-pen garden-icon"></i> è‡ªå®šä¹‰å²—ä½åç§°</label>
                                    <input type="text" id="customPositionName" placeholder="è¯·è¾“å…¥æ‚¨æƒ³æ‹…ä»»çš„è‡ªå®šä¹‰å²—ä½åç§°">
                                </div>
                                
                                <div class="form-group">
                                    <label for="customPositionDescription"><i class="fas fa-file-alt garden-icon"></i> å²—ä½èŒè´£æè¿°</label>
                                    <textarea id="customPositionDescription" rows="3" placeholder="è¯·æè¿°è¯¥å²—ä½çš„èŒè´£å’Œå·¥ä½œå†…å®¹"></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="customPositionReason"><i class="fas fa-lightbulb garden-icon"></i> ç”³è¯·ç†ç”±ä¸ä¼˜åŠ¿</label>
                                    <textarea id="customPositionReason" rows="3" placeholder="è¯·è¯´æ˜æ‚¨ç”³è¯·è¯¥å²—ä½çš„ç†ç”±ä»¥åŠæ‚¨çš„ä¼˜åŠ¿"></textarea>
                                </div>
                                
                                <button class="btn btn-small" id="addCustomPositionBtn">
                                    <i class="fas fa-plus"></i> æ·»åŠ è‡ªå®šä¹‰å²—ä½
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="garden-card">
                    <h2 class="section-title"><i class="fas fa-edit"></i> æ„å‘å¡«æŠ¥</h2>
                    <form id="intentionForm">
                        <div class="form-group">
                            <label for="name"><i class="fas fa-user garden-icon"></i> å§“å</label>
                            <input type="text" id="name" name="name" required placeholder="è¯·è¾“å…¥æ‚¨çš„å§“å">
                        </div>
                        
                        <div class="form-group">
                            <label for="studentIdDisplay"><i class="fas fa-id-card garden-icon"></i> å­¦å·</label>
                            <input type="text" id="studentIdDisplay" name="studentId" placeholder="è¯·è¾“å…¥å­¦å·ï¼ˆå¯é€‰ï¼‰">
                        </div>
                        
                        <div class="form-group">
                            <label for="class"><i class="fas fa-graduation-cap garden-icon"></i> ç­çº§</label>
                            <input type="text" id="class" name="class" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label><i class="fas fa-star garden-icon"></i> å²—ä½æ„å‘ (æŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½)</label>
                            <p style="font-size: 0.9rem; color: #666; margin-bottom: 10px;">æ‚¨å¯ä»¥é€‰æ‹©ç°æœ‰å²—ä½æˆ–å·²æ·»åŠ çš„è‡ªå®šä¹‰å²—ä½</p>
                            <div class="priority-group">
                                <div class="priority-item">
                                    <label for="priority1">ç¬¬ä¸€å¿—æ„¿</label>
                                    <select id="priority1" name="priority1" required>
                                        <option value="">è¯·é€‰æ‹©ç¬¬ä¸€å¿—æ„¿</option>
                                        <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </select>
                                </div>
                                <div class="priority-item">
                                    <label for="priority2">ç¬¬äºŒå¿—æ„¿</label>
                                    <select id="priority2" name="priority2">
                                        <option value="">è¯·é€‰æ‹©ç¬¬äºŒå¿—æ„¿</option>
                                        <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </select>
                                </div>
                                <div class="priority-item">
                                    <label for="priority3">ç¬¬ä¸‰å¿—æ„¿</label>
                                    <select id="priority3" name="priority3">
                                        <option value="">è¯·é€‰æ‹©ç¬¬ä¸‰å¿—æ„¿</option>
                                        <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label for="experience"><i class="fas fa-history garden-icon"></i> ç›¸å…³ç»éªŒä¸ä¼˜åŠ¿</label>
                            <textarea id="experience" name="experience" rows="4" placeholder="è¯·ç®€è¦è¯´æ˜æ‚¨æ‹…ä»»ç­å¹²éƒ¨çš„ç›¸å…³ç»éªŒã€ä¸ªäººä¼˜åŠ¿åŠç«é€‰ç†ç”±..."></textarea>
                        </div>
                        
                        <button type="submit" class="btn">
                            <i class="fas fa-paper-plane"></i> æäº¤æ„å‘
                        </button>
                    </form>
                </div>
                
                <div class="garden-card">
                    <h2 class="section-title"><i class="fas fa-clipboard-check"></i> æˆ‘çš„æŠ¥åæƒ…å†µ</h2>
                    <div id="myApplicationsContainer">
                        <div class="empty-state">
                            <i class="fas fa-seedling"></i>
                            <p>æ‚¨è¿˜æ²¡æœ‰æäº¤ä»»ä½•æ„å‘ï¼Œè¯·åœ¨ä¸Šæ–¹è¡¨æ ¼ä¸­å¡«å†™å¹¶æäº¤</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç­ä¸»ä»»ç«¯ç•Œé¢ -->
            <div class="admin-panel" id="adminPanel">
                <div class="garden-card">
                    <h2 class="section-title"><i class="fas fa-chart-bar"></i> ç­å¹²éƒ¨å²—ä½æŠ¥åæƒ…å†µç»Ÿè®¡</h2>
                    <p style="margin-bottom: 20px; color: #666;">ç‚¹å‡»ä¸‹æ–¹å²—ä½å¡ç‰‡æŸ¥çœ‹è¯¥å²—ä½çš„æŠ¥åå­¦ç”Ÿä¿¡æ¯ï¼Œæ‚¨å¯ä»¥åœ¨æ­¤ç®¡ç†æ‰€æœ‰æŠ¥åæ•°æ®ã€‚</p>
                    
                    <div class="position-category">
                        <h3 style="color: #1b5e20; margin-bottom: 15px; padding-left: 10px; border-left: 4px solid #4caf50;">ğŸ¯ é‡è¦å²—ä½</h3>
                        <div class="positions-grid" id="adminImportantPositions">
                            <!-- é‡è¦å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="position-category">
                        <h3 style="color: #1b5e20; margin-bottom: 15px; padding-left: 10px; border-left: 4px solid #4caf50;">ğŸ‹ ä¸“é¡¹å²—ä½</h3>
                        <div class="positions-grid" id="adminSpecialPositions">
                            <!-- ä¸“é¡¹å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="position-category">
                        <h3 style="color: #1b5e20; margin-bottom: 15px; padding-left: 10px; border-left: 4px solid #4caf50;">ğŸ“š å­¦ç§‘å²—ä½</h3>
                        <div class="positions-grid" id="adminAcademicPositions">
                            <!-- å­¦ç§‘å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="position-category">
                        <h3 style="color: #1b5e20; margin-bottom: 15px; padding-left: 10px; border-left: 4px solid #4caf50;">ğŸ”‘ æ‰¿åŒ…ç®¡ç†å²—ä½</h3>
                        <div class="positions-grid" id="adminManagePositions">
                            <!-- æ‰¿åŒ…ç®¡ç†å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div class="position-category">
                        <h3 style="color: #1b5e20; margin-bottom: 15px; padding-left: 10px; border-left: 4px solid #ff8f00;">âœ¨ è‡ªå®šä¹‰å²—ä½</h3>
                        <div class="positions-grid" id="adminCustomPositions">
                            <!-- è‡ªå®šä¹‰å²—ä½å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                    
                    <div style="margin-top: 40px; text-align: center;">
                        <button class="btn btn-secondary" id="exportDataBtn">
                            <i class="fas fa-file-excel"></i> å¯¼å‡ºæŠ¥åæ•°æ®
                        </button>
                        <button class="btn" id="generateReportBtn" style="margin-left: 10px;">
                            <i class="fas fa-chart-pie"></i> ç”Ÿæˆåˆ†ææŠ¥å‘Š
                        </button>
                    </div>
                </div>
                
                <div class="garden-card" id="adminResultsSection">
                    <h2 class="section-title"><i class="fas fa-users"></i> å²—ä½æŠ¥åè¯¦æƒ…</h2>
                    <div id="adminResultsContainer">
                        <div class="empty-state">
                            <i class="fas fa-mouse-pointer"></i>
                            <p>ç‚¹å‡»ä¸Šæ–¹å²—ä½å¡ç‰‡æŸ¥çœ‹è¯¥å²—ä½çš„æŠ¥åå­¦ç”Ÿä¿¡æ¯</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ç­çº§ç®¡ç†ç•Œé¢ -->
            <div class="admin-panel" id="managePanel">
                <div class="garden-card">
                    <h2 class="section-title"><i class="fas fa-cogs"></i> ç­çº§ç®¡ç†</h2>
                    
                    <div class="class-info">
                        <div class="class-info-item">
                            <h3 style="color: #1b5e20; margin-bottom: 10px;">ç­çº§ä¿¡æ¯</h3>
                            <p><strong>ç­çº§åç§°:</strong> <span id="currentClassName">æœªè®¾ç½®</span></p>
                            <p><strong>ç­ä¸»ä»»:</strong> <span id="currentTeacherName">æœªè®¾ç½®</span></p>
                            <p><strong>åˆ›å»ºæ—¶é—´:</strong> <span id="classCreateTime">æœªè®¾ç½®</span></p>
                            <p><strong>å­¦ç”Ÿäººæ•°:</strong> <span id="studentCount">0</span> äºº</p>
                            <p><strong>æ„å‘æäº¤:</strong> <span id="intentionCount">0</span> ä»½</p>
                        </div>
                        
                        <div class="class-info-item">
                            <div class="class-code-box">
                                <h4 style="color: #1b5e20; margin-bottom: 10px;">ç­çº§ä»£ç </h4>
                                <div class="class-code" id="classCode">----</div>
                                <p style="font-size: 0.9rem; color: #666;">å­¦ç”Ÿä½¿ç”¨æ­¤ä»£ç åŠ å…¥ç­çº§</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="invite-link">
                        <input type="text" id="inviteLink" readonly placeholder="é‚€è¯·é“¾æ¥">
                        <button class="btn btn-small" onclick="copyInviteLink()">
                            <i class="fas fa-copy"></i> å¤åˆ¶
                        </button>
                    </div>
                    
                    <div class="qr-code-container">
                        <div class="qr-code">
                            <i class="fas fa-qrcode"></i>
                        </div>
                        <p>æ‰«æäºŒç»´ç åŠ å…¥ç­çº§</p>
                    </div>
                    
                    <div class="share-buttons">
                        <button class="share-btn" onclick="shareClass('wechat')">
                            <i class="fab fa-weixin"></i> å¾®ä¿¡
                        </button>
                        <button class="share-btn" onclick="shareClass('qq')">
                            <i class="fab fa-qq"></i> QQ
                        </button>
                        <button class="share-btn" onclick="shareClass('link')">
                            <i class="fas fa-link"></i> å¤åˆ¶é“¾æ¥
                        </button>
                    </div>
                </div>
                
                <div class="garden-card">
                    <h2 class="section-title"><i class="fas fa-edit"></i> ç¼–è¾‘ç­çº§è®¾ç½®</h2>
                    
                    <div class="form-group">
                        <label for="editClassName"><i class="fas fa-graduation-cap garden-icon"></i> ç­çº§åç§°</label>
                        <input type="text" id="editClassName" placeholder="ä¿®æ”¹ç­çº§åç§°">
                    </div>
                    
                    <div class="form-group">
                        <label for="editAnnouncement"><i class="fas fa-bullhorn garden-icon"></i> å…¬å‘Šå†…å®¹</label>
                        <textarea id="editAnnouncement" rows="3" placeholder="è¾“å…¥ç­çº§å…¬å‘Š"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="deadlineDate"><i class="fas fa-calendar-alt garden-icon"></i> æˆªæ­¢æ—¥æœŸ</label>
                        <input type="date" id="deadlineDate">
                    </div>
                    
                    <button class="btn" id="saveClassSettingsBtn">
                        <i class="fas fa-save"></i> ä¿å­˜è®¾ç½®
                    </button>
                </div>
                
                <div class="garden-card">
                    <h2 class="section-title"><i class="fas fa-user-shield"></i> ä¿®æ”¹ç­ä¸»ä»»å¯†ç </h2>
                    
                    <div class="form-group">
                        <label for="currentPassword">å½“å‰å¯†ç </label>
                        <input type="password" id="currentPassword" placeholder="è¯·è¾“å…¥å½“å‰å¯†ç ">
                    </div>
                    
                    <div class="form-group">
                        <label for="newTeacherPassword">æ–°å¯†ç </label>
                        <input type="password" id="newTeacherPassword" placeholder="è¯·è¾“å…¥æ–°å¯†ç ">
                    </div>
                    
                    <div class="form-group">
                        <label for="confirmTeacherPassword">ç¡®è®¤æ–°å¯†ç </label>
                        <input type="password" id="confirmTeacherPassword" placeholder="è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ">
                    </div>
                    
                    <button class="btn" id="changePasswordBtn">
                        <i class="fas fa-sync-alt"></i> ä¿®æ”¹å¯†ç 
                    </button>
                </div>
                
                <div class="garden-card">
                    <h2 class="section-title"><i class="fas fa-users"></i> å­¦ç”Ÿç®¡ç†</h2>
                    
                    <div id="studentsList">
                        <div class="empty-state">
                            <i class="fas fa-user-graduate"></i>
                            <p>æš‚æ— å­¦ç”ŸåŠ å…¥</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- é¡µè„š -->
            <footer class="garden-footer">
                <p>Â© 2023 ç­å¹²éƒ¨æ„å‘æ”¶é›†ç³»ç»Ÿ | æŠ€æœ¯æ”¯æŒ: æ•™è‚²æŠ€æœ¯ä¸­å¿ƒ | æ•°æ®å®‰å…¨: äº‘ç«¯åŠ å¯†å­˜å‚¨</p>
                <p>ğŸ åº­å›­è‚²æ‰ï¼Œç­å¹²èšè´¤ ğŸ</p>
            </footer>
        </div>
    </div>

    <script>
        // æ¨¡æ‹Ÿäº‘å­˜å‚¨API
        class CloudStorage {
            constructor() {
                this.baseUrl = 'https://api.classmonitor.com';
                this.cache = new Map();
                this.init();
            }
            
            init() {
                // æ¨¡æ‹Ÿç½‘ç»œçŠ¶æ€
                this.isOnline = navigator.onLine;
                window.addEventListener('online', () => {
                    this.isOnline = true;
                    this.syncPendingChanges();
                });
                window.addEventListener('offline', () => {
                    this.isOnline = false;
                });
            }
            
            // ç”Ÿæˆå”¯ä¸€ID
            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }
            
            // æ¨¡æ‹ŸAPIè¯·æ±‚
            async apiRequest(endpoint, method = 'GET', data = null) {
                // æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
                await new Promise(resolve => setTimeout(resolve, 300));
                
                const key = `${method}:${endpoint}:${JSON.stringify(data)}`;
                
                if (method === 'GET' && this.cache.has(key)) {
                    return this.cache.get(key);
                }
                
                // æ¨¡æ‹ŸAPIå“åº”
                let response;
                switch (endpoint) {
                    case '/classes':
                        response = this.handleClassesRequest(method, data);
                        break;
                    case '/intentions':
                        response = this.handleIntentionsRequest(method, data);
                        break;
                    case '/positions':
                        response = this.handlePositionsRequest(method, data);
                        break;
                    case '/auth':
                        response = this.handleAuthRequest(method, data);
                        break;
                    default:
                        response = { success: false, message: 'APIä¸å­˜åœ¨' };
                }
                
                if (response.success && method === 'GET') {
                    this.cache.set(key, response);
                }
                
                return response;
            }
            
            handleClassesRequest(method, data) {
                let classes = JSON.parse(localStorage.getItem('cloud_classes') || '{}');
                
                if (method === 'POST') {
                    // åˆ›å»ºç­çº§
                    const classId = this.generateId();
                    const classCode = this.generateClassCode();
                    
                    const newClass = {
                        id: classId,
                        code: classCode,
                        name: data.name,
                        teacherName: data.teacherName,
                        teacherEmail: data.teacherEmail,
                        password: data.password,
                        createdAt: new Date().toISOString(),
                        students: [],
                        announcements: [],
                        settings: {
                            deadline: null,
                            allowCustomPositions: true
                        }
                    };
                    
                    classes[classId] = newClass;
                    localStorage.setItem('cloud_classes', JSON.stringify(classes));
                    
                    return {
                        success: true,
                        data: newClass,
                        message: 'ç­çº§åˆ›å»ºæˆåŠŸ'
                    };
                }
                
                if (method === 'GET' && data && data.code) {
                    // æ ¹æ®ä»£ç æŸ¥æ‰¾ç­çº§
                    const classEntry = Object.values(classes).find(c => c.code === data.code);
                    if (classEntry) {
                        return {
                            success: true,
                            data: classEntry
                        };
                    }
                    return {
                        success: false,
                        message: 'ç­çº§ä¸å­˜åœ¨'
                    };
                }
                
                return { success: false, message: 'æ— æ•ˆè¯·æ±‚' };
            }
            
            handleIntentionsRequest(method, data) {
                const classId = data.classId;
                let intentions = JSON.parse(localStorage.getItem(`intentions_${classId}`) || '[]');
                
                if (method === 'POST') {
                    const newIntention = {
                        id: this.generateId(),
                        ...data,
                        submittedAt: new Date().toISOString(),
                        status: 'pending'
                    };
                    
                    intentions.push(newIntention);
                    localStorage.setItem(`intentions_${classId}`, JSON.stringify(intentions));
                    
                    return {
                        success: true,
                        data: newIntention
                    };
                }
                
                if (method === 'GET') {
                    return {
                        success: true,
                        data: intentions
                    };
                }
                
                return { success: false, message: 'æ— æ•ˆè¯·æ±‚' };
            }
            
            handlePositionsRequest(method, data) {
                const classId = data.classId;
                let positions = JSON.parse(localStorage.getItem(`positions_${classId}`) || '[]');
                
                if (positions.length === 0) {
                    // åˆå§‹åŒ–é»˜è®¤å²—ä½
                    positions = [...basePositions];
                    localStorage.setItem(`positions_${classId}`, JSON.stringify(positions));
                }
                
                if (method === 'GET') {
                    return {
                        success: true,
                        data: positions
                    };
                }
                
                if (method === 'POST' && data.custom) {
                    const newPosition = {
                        id: this.generateId(),
                        ...data,
                        category: 'custom',
                        createdAt: new Date().toISOString()
                    };
                    
                    positions.push(newPosition);
                    localStorage.setItem(`positions_${classId}`, JSON.stringify(positions));
                    
                    return {
                        success: true,
                        data: newPosition
                    };
                }
                
                return { success: false, message: 'æ— æ•ˆè¯·æ±‚' };
            }
            
            handleAuthRequest(method, data) {
                const classes = JSON.parse(localStorage.getItem('cloud_classes') || '{}');
                const classEntry = Object.values(classes).find(c => c.code === data.code);
                
                if (!classEntry) {
                    return {
                        success: false,
                        message: 'ç­çº§ä¸å­˜åœ¨'
                    };
                }
                
                if (data.role === 'teacher') {
                    if (classEntry.password === data.password) {
                        return {
                            success: true,
                            data: {
                                classId: classEntry.id,
                                role: 'teacher',
                                teacherName: classEntry.teacherName
                            }
                        };
                    }
                    return {
                        success: false,
                        message: 'å¯†ç é”™è¯¯'
                    };
                }
                
                if (data.role === 'student') {
                    // æ£€æŸ¥å­¦ç”Ÿæ˜¯å¦å·²å­˜åœ¨
                    let student = classEntry.students.find(s => s.name === data.name);
                    if (!student) {
                        student = {
                            id: this.generateId(),
                            name: data.name,
                            studentId: data.studentId,
                            joinedAt: new Date().toISOString()
                        };
                        classEntry.students.push(student);
                        classes[classEntry.id] = classEntry;
                        localStorage.setItem('cloud_classes', JSON.stringify(classes));
                    }
                    
                    return {
                        success: true,
                        data: {
                            classId: classEntry.id,
                            role: 'student',
                            studentName: student.name,
                            studentId: student.studentId
                        }
                    };
                }
                
                return { success: false, message: 'æ— æ•ˆèº«ä»½' };
            }
            
            generateClassCode() {
                const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                let code = '';
                for (let i = 0; i < 6; i++) {
                    code += chars.charAt(Math.floor(Math.random() * chars.length));
                }
                return code;
            }
            
            async syncPendingChanges() {
                // åŒæ­¥å¾…å¤„ç†æ›´æ”¹
                const pending = JSON.parse(localStorage.getItem('pending_changes') || '[]');
                if (pending.length === 0) return;
                
                for (const change of pending) {
                    try {
                        await this.apiRequest(change.endpoint, change.method, change.data);
                    } catch (error) {
                        console.error('åŒæ­¥å¤±è´¥:', error);
                    }
                }
                
                localStorage.removeItem('pending_changes');
                showToast('æ•°æ®åŒæ­¥å®Œæˆ', 'success');
            }
            
            // æ·»åŠ ç¦»çº¿ç¼“å­˜
            async getWithCache(endpoint, params) {
                const cacheKey = `cache_${endpoint}_${JSON.stringify(params)}`;
                const cached = localStorage.getItem(cacheKey);
                
                if (cached && this.isOnline) {
                    return JSON.parse(cached);
                }
                
                try {
                    const result = await this.apiRequest(endpoint, 'GET', params);
                    if (result.success) {
                        localStorage.setItem(cacheKey, JSON.stringify(result));
                    }
                    return result;
                } catch (error) {
                    // ç¦»çº¿æ—¶è¿”å›ç¼“å­˜æ•°æ®
                    if (cached) {
                        return JSON.parse(cached);
                    }
                    throw error;
                }
            }
        }
        
        // ç­å¹²éƒ¨å²—ä½æ•°æ®
        const basePositions = [
            // é‡è¦å²—ä½
            { 
                id: "monitor", 
                name: "ç­é•¿", 
                description: "å…¨é¢è´Ÿè´£ç­çº§å·¥ä½œï¼Œåè°ƒå„ç­å§”å·¥ä½œï¼Œä¸»æŒç­çº§ä¼šè®®",
                category: "important"
            },
            { 
                id: "vice_monitor", 
                name: "å‰¯ç­é•¿", 
                description: "ååŠ©ç­é•¿å·¥ä½œï¼Œåˆ†ç®¡çºªå¾‹å’Œè€ƒå‹¤",
                category: "important"
            },
            { 
                id: "weekly_monitor", 
                name: "å€¼å‘¨ç­é•¿", 
                description: "è´Ÿè´£ä¸€å‘¨å†…çš„ç­çº§æ—¥å¸¸ç®¡ç†",
                category: "important"
            },
            { 
                id: "league_secretary", 
                name: "å›¢æ”¯ä¹¦", 
                description: "è´Ÿè´£ç­çº§å›¢æ”¯éƒ¨å·¥ä½œï¼Œç»„ç»‡å›¢å‘˜æ´»åŠ¨",
                category: "important"
            },
            
            // ä¸“é¡¹å²—ä½
            { 
                id: "boarding_monitor", 
                name: "ä½æ ¡ç”Ÿç­é•¿", 
                description: "è´Ÿè´£ä½æ ¡ç”Ÿçš„æ—¥å¸¸ç®¡ç†å’Œå®¿èˆåè°ƒ",
                category: "special"
            },
            { 
                id: "day_student_monitor", 
                name: "é€šæ ¡ç”Ÿç­é•¿", 
                description: "è´Ÿè´£é€šæ ¡ç”Ÿçš„è”ç³»å’Œé—®é¢˜åé¦ˆ",
                category: "special"
            },
            { 
                id: "health_commissar", 
                name: "å«ç”Ÿå§”å‘˜", 
                description: "è´Ÿè´£ç­çº§å«ç”Ÿå®‰æ’å’Œæ£€æŸ¥",
                category: "special"
            },
            { 
                id: "publicity_commissar", 
                name: "å®£ä¼ å§”å‘˜", 
                description: "è´Ÿè´£ç­çº§å®£ä¼ ã€æ¿æŠ¥å’Œæ´»åŠ¨è®°å½•",
                category: "special"
            },
            { 
                id: "organization_commissar", 
                name: "ç»„ç»‡å§”å‘˜", 
                description: "è´Ÿè´£ç­çº§æ´»åŠ¨ç»„ç»‡å’Œç­–åˆ’",
                category: "special"
            },
            { 
                id: "art_commissar", 
                name: "æ–‡è‰ºå§”å‘˜", 
                description: "è´Ÿè´£æ–‡è‰ºæ´»åŠ¨å’Œç­çº§æ–‡è‰ºæ°›å›´",
                category: "special"
            },
            { 
                id: "psychology_commissar", 
                name: "å¿ƒç†å§”å‘˜", 
                description: "å…³æ³¨åŒå­¦å¿ƒç†å¥åº·ï¼Œç»„ç»‡å¿ƒç†æ´»åŠ¨",
                category: "special"
            },
            { 
                id: "safety_commissar", 
                name: "å®‰å…¨å§”å‘˜", 
                description: "è´Ÿè´£ç­çº§å®‰å…¨æ•™è‚²å’Œå®‰å…¨æ£€æŸ¥",
                category: "special"
            },
            { 
                id: "health_leader", 
                name: "å«ç”Ÿç»„é•¿", 
                description: "è´Ÿè´£å°ç»„å«ç”Ÿå®‰æ’å’Œæ£€æŸ¥",
                category: "special"
            },
            
            // å­¦ç§‘å²—ä½
            { 
                id: "study_commissar", 
                name: "å­¦ä¹ å§”å‘˜", 
                description: "è´Ÿè´£å­¦ä¹ ç›¸å…³äº‹åŠ¡ï¼Œæ”¶é›†å­¦ä¹ é—®é¢˜",
                category: "academic"
            },
            { 
                id: "chinese_representative", 
                name: "è¯­æ–‡ç§‘ä»£è¡¨", 
                description: "è´Ÿè´£è¯­æ–‡ä½œä¸šæ”¶å‘ï¼Œæ²Ÿé€šå¸ˆç”Ÿ",
                category: "academic"
            },
            { 
                id: "math_representative", 
                name: "æ•°å­¦ç§‘ä»£è¡¨", 
                description: "è´Ÿè´£æ•°å­¦ä½œä¸šæ”¶å‘ï¼Œæ²Ÿé€šå¸ˆç”Ÿ",
                category: "academic"
            },
            { 
                id: "english_representative", 
                name: "è‹±è¯­ç§‘ä»£è¡¨", 
                description: "è´Ÿè´£è‹±è¯­ä½œä¸šæ”¶å‘ï¼Œæ²Ÿé€šå¸ˆç”Ÿ",
                category: "academic"
            },
            { 
                id: "plant_recognition_representative", 
                name: "æ¤ç‰©è¯†åˆ«ç§‘ä»£è¡¨", 
                description: "è´Ÿè´£æ¤ç‰©è¯†åˆ«ç›¸å…³å­¦ç§‘äº‹åŠ¡",
                category: "academic"
            },
            { 
                id: "drafting_representative", 
                name: "åˆ¶å›¾ç§‘ä»£è¡¨", 
                description: "è´Ÿè´£åˆ¶å›¾ç›¸å…³å­¦ç§‘äº‹åŠ¡",
                category: "academic"
            },
            
            // æ‰¿åŒ…ç®¡ç†å²—ä½
            { 
                id: "locker_manager", 
                name: "é“çš®æŸœç®¡ç†å‘˜", 
                description: "è´Ÿè´£ç­çº§é“çš®æŸœçš„ç®¡ç†å’Œç»´æŠ¤",
                category: "manage"
            },
            { 
                id: "phone_manager", 
                name: "æ‰‹æœºç®¡ç†å‘˜", 
                description: "è´Ÿè´£ç­çº§æ‰‹æœºçš„ç»Ÿä¸€ç®¡ç†",
                category: "manage"
            },
            { 
                id: "flower_ball_manager", 
                name: "èŠ±çƒç®¡ç†å‘˜", 
                description: "è´Ÿè´£ç­çº§èŠ±çƒçš„ç»´æŠ¤å’Œä¿å…»",
                category: "manage"
            },
            { 
                id: "plant_manager", 
                name: "æ¤ç‰©ç®¡ç†å‘˜", 
                description: "è´Ÿè´£ç­çº§æ¤ç‰©çš„å…»æŠ¤",
                category: "manage"
            },
            { 
                id: "marker_manager", 
                name: "æ°´å½©ç¬”ç®¡ç†å‘˜", 
                description: "è´Ÿè´£ç­çº§æ°´å½©ç¬”çš„ç®¡ç†",
                category: "manage"
            },
            { 
                id: "certificate_manager", 
                name: "å¥–çŠ¶ç®¡ç†å‘˜", 
                description: "è´Ÿè´£ç­çº§å¥–çŠ¶çš„ä¿ç®¡å’Œå±•ç¤º",
                category: "manage"
            }
        ];
        
        // å…¨å±€æ•°æ®å­˜å‚¨
        let appData = {
            currentUser: null,
            currentClass: null,
            positions: [],
            customPositions: [],
            intentions: [],
            students: [],
            announcements: [],
            cloudStorage: new CloudStorage()
        };
        
        // UIå·¥å…·å‡½æ•°
        function showLoadingOverlay(show, text = 'æ•°æ®åŠ è½½ä¸­... è¯·ç¨å€™') {
            const overlay = document.getElementById('loadingOverlay');
            const textElement = document.getElementById('loadingText');
            
            if (textElement) {
                textElement.textContent = text;
            }
            
            overlay.style.display = show ? 'flex' : 'none';
        }
        
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.getElementById('toastMessage');
            
            const bgColors = {
                success: '#2e7d32',
                error: '#d32f2f',
                warning: '#f57c00',
                info: '#1b5e20'
            };
            
            toast.textContent = message;
            toast.style.background = bgColors[type] || bgColors.info;
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, duration);
        }
        
        function formatDate(dateString) {
            if (!dateString) return '';
            const date = new Date(dateString);
            return date.toLocaleDateString('zh-CN') + ' ' + date.toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'});
        }
        
        // åˆå§‹åŒ–é€‰é¡¹å¡
        function initTabs() {
            const tabs = document.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    const container = this.closest('.tab-container');
                    
                    // æ›´æ–°æ´»è·ƒé€‰é¡¹å¡
                    container.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // æ›´æ–°æ´»è·ƒå†…å®¹
                    container.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    container.querySelector(`#${tabId}-tab`).classList.add('active');
                });
            });
        }
        
        // æ³¨å†Œç­çº§
        async function registerClass() {
            const teacherName = document.getElementById('teacherName').value.trim();
            const className = document.getElementById('className').value.trim();
            const email = document.getElementById('teacherEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!teacherName || !className || !password) {
                showToast('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯', 'error');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½', 'error');
                return;
            }
            
            showLoadingOverlay(true, 'æ­£åœ¨åˆ›å»ºç­çº§...');
            
            try {
                const result = await appData.cloudStorage.apiRequest('/classes', 'POST', {
                    name: className,
                    teacherName: teacherName,
                    teacherEmail: email,
                    password: password
                });
                
                if (result.success) {
                    showToast('ç­çº§åˆ›å»ºæˆåŠŸï¼è¯·ä½¿ç”¨ç­çº§ä»£ç ç™»å½•', 'success');
                    
                    // åˆ‡æ¢åˆ°ç™»å½•é¡µå¹¶å¡«å……ç­çº§ä»£ç 
                    document.querySelector('[data-tab="login"]').click();
                    document.getElementById('loginClassCode').value = result.data.code;
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('teacherName').value = '';
                    document.getElementById('className').value = '';
                    document.getElementById('teacherEmail').value = '';
                    document.getElementById('registerPassword').value = '';
                    document.getElementById('confirmPassword').value = '';
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('åˆ›å»ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                console.error(error);
            } finally {
                showLoadingOverlay(false);
            }
        }
        
        // åŠ å…¥ç­çº§
        async function joinClass() {
            const classCode = document.getElementById('joinClassCode').value.trim().toUpperCase();
            const studentName = document.getElementById('joinStudentName').value.trim();
            const studentId = document.getElementById('joinStudentId').value.trim();
            
            if (!classCode || !studentName) {
                showToast('è¯·å¡«å†™ç­çº§ä»£ç å’Œå§“å', 'error');
                return;
            }
            
            showLoadingOverlay(true, 'æ­£åœ¨åŠ å…¥ç­çº§...');
            
            try {
                const result = await appData.cloudStorage.apiRequest('/auth', 'POST', {
                    code: classCode,
                    role: 'student',
                    name: studentName,
                    studentId: studentId
                });
                
                if (result.success) {
                    // ç™»å½•æˆåŠŸ
                    appData.currentUser = result.data;
                    loadClassData(result.data.classId);
                    showToast('åŠ å…¥ç­çº§æˆåŠŸï¼', 'success');
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('åŠ å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                console.error(error);
            } finally {
                showLoadingOverlay(false);
            }
        }
        
        // ç™»å½•
        async function login() {
            const classCode = document.getElementById('loginClassCode').value.trim().toUpperCase();
            const role = document.getElementById('loginUsername').value;
            const studentId = document.getElementById('studentId').value.trim();
            const password = document.getElementById('teacherPassword').value;
            
            if (!classCode) {
                showToast('è¯·è¾“å…¥ç­çº§ä»£ç ', 'error');
                return;
            }
            
            if (!role) {
                showToast('è¯·é€‰æ‹©èº«ä»½', 'error');
                return;
            }
            
            showLoadingOverlay(true, 'æ­£åœ¨ç™»å½•...');
            
            try {
                const result = await appData.cloudStorage.apiRequest('/auth', 'POST', {
                    code: classCode,
                    role: role,
                    name: studentId,
                    studentId: studentId,
                    password: password
                });
                
                if (result.success) {
                    appData.currentUser = result.data;
                    loadClassData(result.data.classId);
                    showToast('ç™»å½•æˆåŠŸï¼', 'success');
                } else {
                    showToast(result.message, 'error');
                }
            } catch (error) {
                showToast('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥', 'error');
                console.error(error);
            } finally {
                showLoadingOverlay(false);
            }
        }
        
        // åŠ è½½ç­çº§æ•°æ®
        async function loadClassData(classId) {
            showLoadingOverlay(true, 'åŠ è½½ç­çº§æ•°æ®...');
            
            try {
                // åŠ è½½ç­çº§ä¿¡æ¯
                const classes = JSON.parse(localStorage.getItem('cloud_classes') || '{}');
                appData.currentClass = classes[classId];
                
                if (!appData.currentClass) {
                    showToast('ç­çº§æ•°æ®åŠ è½½å¤±è´¥', 'error');
                    return;
                }
                
                // åŠ è½½å²—ä½æ•°æ®
                const positionsResult = await appData.cloudStorage.apiRequest('/positions', 'GET', { classId });
                if (positionsResult.success) {
                    appData.positions = positionsResult.data.filter(p => p.category !== 'custom');
                    appData.customPositions = positionsResult.data.filter(p => p.category === 'custom');
                }
                
                // åŠ è½½æ„å‘æ•°æ®
                const intentionsResult = await appData.cloudStorage.apiRequest('/intentions', 'GET', { classId });
                if (intentionsResult.success) {
                    appData.intentions = intentionsResult.data;
                }
                
                // æ›´æ–°UI
                updateClassInfo();
                switchToMainInterface();
                renderAllData();
                
            } catch (error) {
                showToast('æ•°æ®åŠ è½½å¤±è´¥', 'error');
                console.error(error);
            } finally {
                showLoadingOverlay(false);
            }
        }
        
        // æ›´æ–°ç­çº§ä¿¡æ¯æ˜¾ç¤º
        function updateClassInfo() {
            if (!appData.currentClass) return;
            
            // æ›´æ–°æ ‡é¢˜
            document.getElementById('classTitle').textContent = appData.currentClass.name + ' - ç­å¹²éƒ¨æ„å‘æ”¶é›†';
            document.getElementById('classSubtitle').textContent = `ç­ä¸»ä»»: ${appData.currentClass.teacherName}`;
            
            // æ›´æ–°ç­çº§ç®¡ç†ä¿¡æ¯
            document.getElementById('currentClassName').textContent = appData.currentClass.name;
            document.getElementById('currentTeacherName').textContent = appData.currentClass.teacherName;
            document.getElementById('classCreateTime').textContent = formatDate(appData.currentClass.createdAt);
            document.getElementById('classCode').textContent = appData.currentClass.code;
            
            // æ›´æ–°é‚€è¯·é“¾æ¥
            const inviteLink = `${window.location.origin}${window.location.pathname}?class=${appData.currentClass.code}`;
            document.getElementById('inviteLink').value = inviteLink;
            
            // æ›´æ–°å…¬å‘Š
            if (appData.currentClass.announcements && appData.currentClass.announcements.length > 0) {
                const latestAnnouncement = appData.currentClass.announcements[appData.currentClass.announcements.length - 1];
                document.getElementById('announcementContent').textContent = latestAnnouncement.content;
            }
            
            // æ›´æ–°å­¦ç”Ÿæ•°é‡
            const studentCount = appData.currentClass.students.length;
            document.getElementById('studentCount').textContent = studentCount;
            document.getElementById('intentionCount').textContent = appData.intentions.length;
            
            // æ¸²æŸ“å­¦ç”Ÿåˆ—è¡¨
            renderStudentsList();
            
            // æ¸²æŸ“ç»Ÿè®¡æ•°æ®
            renderStatistics();
        }
        
        // æ¸²æŸ“æ‰€æœ‰æ•°æ®
        function renderAllData() {
            renderPositions();
            renderCustomPositions();
            updatePrioritySelectOptions();
            renderMyApplications();
            renderAdminPositions();
            renderStatistics();
        }
        
        // æ¸²æŸ“å²—ä½
        function renderPositions() {
            const categories = ['important', 'special', 'academic', 'manage'];
            const stats = getPositionStatistics();
            
            categories.forEach(category => {
                const container = document.getElementById(`${category}Positions`);
                if (!container) return;
                
                const positions = appData.positions.filter(p => p.category === category);
                container.innerHTML = positions.map(position => {
                    const count = stats[position.name] || 0;
                    return renderPositionCard(position, category, count);
                }).join('');
            });
        }
        
        function renderAdminPositions() {
            const categories = ['important', 'special', 'academic', 'manage'];
            const stats = getPositionStatistics();
            
            categories.forEach(category => {
                const container = document.getElementById(`admin${category.charAt(0).toUpperCase() + category.slice(1)}Positions`);
                if (!container) return;
                
                const positions = appData.positions.filter(p => p.category === category);
                container.innerHTML = positions.map(position => {
                    const count = stats[position.name] || 0;
                    return `
                        <div class="position-card" onclick="showApplicantsForPosition('${position.name}')">
                            <div class="role-badge ${category}-role">${getCategoryLabel(category)}</div>
                            <h3>${position.name}</h3>
                            <p>${position.description}</p>
                            <div class="applicant-count">${count}</div>
                        </div>
                    `;
                }).join('');
            });
            
            // æ¸²æŸ“è‡ªå®šä¹‰å²—ä½
            const adminCustomContainer = document.getElementById('adminCustomPositions');
            if (adminCustomContainer) {
                adminCustomContainer.innerHTML = appData.customPositions.map(position => {
                    const count = stats[position.name] || 0;
                    return `
                        <div class="position-card" onclick="showApplicantsForPosition('${position.name}')">
                            <div class="role-badge custom-role">è‡ªå®šä¹‰</div>
                            <h3>${position.name}</h3>
                            <p>${position.description || 'æš‚æ— æè¿°'}</p>
                            <div class="applicant-count">${count}</div>
                        </div>
                    `;
                }).join('');
            }
        }
        
        function renderPositionCard(position, category, count = 0) {
            return `
                <div class="position-card">
                    ${count > 0 ? `<div class="applicant-count">${count}</div>` : ''}
                    <div class="role-badge ${category}-role">${getCategoryLabel(category)}</div>
                    <h3>${position.name}</h3>
                    <p>${position.description || 'æš‚æ— æè¿°'}</p>
                </div>
            `;
        }
        
        function getCategoryLabel(category) {
            const labels = {
                'important': 'é‡è¦å²—ä½',
                'special': 'ä¸“é¡¹å²—ä½',
                'academic': 'å­¦ç§‘å²—ä½',
                'manage': 'æ‰¿åŒ…ç®¡ç†',
                'custom': 'è‡ªå®šä¹‰'
            };
            return labels[category] || 'å…¶ä»–';
        }
        
        function getPositionStatistics() {
            const stats = {};
            appData.intentions.forEach(intention => {
                [intention.priority1, intention.priority2, intention.priority3].forEach(position => {
                    if (position) {
                        stats[position] = (stats[position] || 0) + 1;
                    }
                });
            });
            return stats;
        }
        
        function renderCustomPositions() {
            const container = document.getElementById('customPositionsList');
            if (!container) return;
            
            if (appData.customPositions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">æš‚æ— è‡ªå®šä¹‰å²—ä½</p>';
            } else {
                container.innerHTML = appData.customPositions.map(position => `
                    <div class="custom-position-item">
                        <div>
                            <div class="custom-position-name">${position.name}</div>
                            <div class="custom-position-description">${position.description || 'æš‚æ— æè¿°'}</div>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function updatePrioritySelectOptions() {
            const selects = ['priority1', 'priority2', 'priority3'];
            const allPositions = [
                ...appData.positions.map(p => p.name),
                ...appData.customPositions.map(p => p.name)
            ];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (!select) return;
                
                // ä¿ç•™ç¬¬ä¸€ä¸ªç©ºé€‰é¡¹
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                allPositions.forEach(position => {
                    const option = document.createElement('option');
                    option.value = position;
                    option.textContent = position;
                    select.appendChild(option);
                });
            });
            
            // æ›´æ–°ç­çº§åç§°
            if (appData.currentClass) {
                document.getElementById('class').value = appData.currentClass.name;
            }
        }
        
        function renderMyApplications() {
            const container = document.getElementById('myApplicationsContainer');
            if (!container || !appData.currentUser) return;
            
            if (appData.currentUser.role !== 'student') return;
            
            const myApplications = appData.intentions.filter(app => 
                app.name === appData.currentUser.studentName
            );
            
            if (myApplications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-seedling"></i>
                        <p>æ‚¨è¿˜æ²¡æœ‰æäº¤ä»»ä½•æ„å‘</p>
                    </div>
                `;
            } else {
                container.innerHTML = myApplications.map((app, index) => `
                    <div class="my-application-item">
                        <div class="my-application-header">
                            <div>
                                <strong>ç”³è¯· #${index + 1}</strong>
                                <span style="margin-left: 10px; color: #666; font-size: 0.9rem;">${formatDate(app.submittedAt)}</span>
                            </div>
                            <div class="my-application-status status-pending">å¾…å®¡æ ¸</div>
                        </div>
                        <div style="margin: 15px 0;">
                            <div><strong>ç¬¬ä¸€å¿—æ„¿:</strong> ${app.priority1 || 'æœªé€‰æ‹©'}</div>
                            <div><strong>ç¬¬äºŒå¿—æ„¿:</strong> ${app.priority2 || 'æœªé€‰æ‹©'}</div>
                            <div><strong>ç¬¬ä¸‰å¿—æ„¿:</strong> ${app.priority3 || 'æœªé€‰æ‹©'}</div>
                        </div>
                        <div>
                            <strong>ç”³è¯·ç†ç”±:</strong>
                            <p style="margin-top: 5px; color: #666;">${app.experience || 'æ— '}</p>
                        </div>
                    </div>
                `).join('');
            }
        }
        
        function renderStatistics() {
            const container = document.getElementById('statsGrid');
            if (!container) return;
            
            const totalStudents = appData.currentClass.students.length;
            const totalIntentions = appData.intentions.length;
            const uniqueApplicants = new Set(appData.intentions.map(i => i.name)).size;
            const popularPosition = getMostPopularPosition();
            
            container.innerHTML = `
                <div class="stat-card">
                    <i class="fas fa-users" style="font-size: 2rem; color: #4caf50;"></i>
                    <div class="stat-number">${totalStudents}</div>
                    <div class="stat-label">ç­çº§äººæ•°</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-file-alt" style="font-size: 2rem; color: #2196f3;"></i>
                    <div class="stat-number">${totalIntentions}</div>
                    <div class="stat-label">æ„å‘æäº¤</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-user-check" style="font-size: 2rem; color: #ff9800;"></i>
                    <div class="stat-number">${uniqueApplicants}</div>
                    <div class="stat-label">å·²ç”³è¯·äººæ•°</div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-star" style="font-size: 2rem; color: #9c27b0;"></i>
                    <div class="stat-number">${popularPosition.count || 0}</div>
                    <div class="stat-label">${popularPosition.name || 'æš‚æ— '}</div>
                </div>
            `;
            
            document.getElementById('statsCard').style.display = 'block';
        }
        
        function getMostPopularPosition() {
            const stats = getPositionStatistics();
            let maxCount = 0;
            let popularPosition = '';
            
            Object.entries(stats).forEach(([position, count]) => {
                if (count > maxCount) {
                    maxCount = count;
                    popularPosition = position;
                }
            });
            
            return { name: popularPosition, count: maxCount };
        }
        
        function renderStudentsList() {
            const container = document.getElementById('studentsList');
            if (!container || !appData.currentClass) return;
            
            const students = appData.currentClass.students;
            
            if (students.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-graduate"></i>
                        <p>æš‚æ— å­¦ç”ŸåŠ å…¥</p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <h3 style="color: #1b5e20; margin-bottom: 15px;">å­¦ç”Ÿåˆ—è¡¨ (${students.length}äºº)</h3>
                    <div style="max-height: 400px; overflow-y: auto;">
                        ${students.map(student => `
                            <div class="applicant-item" style="margin-bottom: 10px;">
                                <div class="applicant-header">
                                    <div class="applicant-name">${student.name}</div>
                                    <div>å­¦å·: ${student.studentId || 'æœªå¡«å†™'}</div>
                                </div>
                                <div style="color: #666; font-size: 0.9rem;">
                                    åŠ å…¥æ—¶é—´: ${formatDate(student.joinedAt)}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
        }
        
        // äº‹ä»¶å¤„ç†å‡½æ•°
        async function submitIntention(e) {
            e.preventDefault();
            
            if (!appData.currentUser || appData.currentUser.role !== 'student') {
                showToast('è¯·å…ˆç™»å½•å­¦ç”Ÿè´¦å·', 'error');
                return;
            }
            
            const formData = {
                classId: appData.currentUser.classId,
                name: document.getElementById('name').value.trim(),
                studentId: document.getElementById('studentIdDisplay').value.trim(),
                className: document.getElementById('class').value,
                priority1: document.getElementById('priority1').value,
                priority2: document.getElementById('priority2').value,
                priority3: document.getElementById('priority3').value,
                experience: document.getElementById('experience').value.trim()
            };
            
            if (!formData.name || !formData.priority1) {
                showToast('è¯·å¡«å†™å§“åå’Œç¬¬ä¸€å¿—æ„¿', 'error');
                return;
            }
            
            showLoadingOverlay(true, 'æäº¤ä¸­...');
            
            try {
                const result = await appData.cloudStorage.apiRequest('/intentions', 'POST', formData);
                
                if (result.success) {
                    appData.intentions.push(result.data);
                    showToast('æ„å‘æäº¤æˆåŠŸï¼', 'success');
                    
                    // æ›´æ–°UI
                    renderMyApplications();
                    renderStatistics();
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('name').value = '';
                    document.getElementById('experience').value = '';
                } else {
                    showToast('æäº¤å¤±è´¥: ' + result.message, 'error');
                }
            } catch (error) {
                showToast('æäº¤å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', 'error');
            } finally {
                showLoadingOverlay(false);
            }
        }
        
        async function addCustomPosition() {
            if (!appData.currentUser) {
                showToast('è¯·å…ˆç™»å½•', 'error');
                return;
            }
            
            const name = document.getElementById('customPositionName').value.trim();
            const description = document.getElementById('customPositionDescription').value.trim();
            const reason = document.getElementById('customPositionReason').value.trim();
            
            if (!name || !description) {
                showToast('è¯·å¡«å†™å²—ä½åç§°å’Œæè¿°', 'error');
                return;
            }
            
            showLoadingOverlay(true, 'æ·»åŠ ä¸­...');
            
            try {
                const result = await appData.cloudStorage.apiRequest('/positions', 'POST', {
                    classId: appData.currentUser.classId,
                    custom: true,
                    name: name,
                    description: description,
                    reason: reason,
                    createdBy: appData.currentUser.role === 'student' ? 
                        appData.currentUser.studentName : appData.currentUser.teacherName
                });
                
                if (result.success) {
                    appData.customPositions.push(result.data);
                    showToast('è‡ªå®šä¹‰å²—ä½æ·»åŠ æˆåŠŸï¼', 'success');
                    
                    // æ›´æ–°UI
                    renderCustomPositions();
                    updatePrioritySelectOptions();
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('customPositionName').value = '';
                    document.getElementById('customPositionDescription').value = '';
                    document.getElementById('customPositionReason').value = '';
                    document.getElementById('customPositionForm').classList.remove('active');
                } else {
                    showToast('æ·»åŠ å¤±è´¥: ' + result.message, 'error');
                }
            } catch (error) {
                showToast('æ·»åŠ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ', 'error');
            } finally {
                showLoadingOverlay(false);
            }
        }
        
        function showApplicantsForPosition(positionName) {
            const container = document.getElementById('adminResultsContainer');
            if (!container) return;
            
            const applicants = appData.intentions.filter(app => 
                app.priority1 === positionName || 
                app.priority2 === positionName || 
                app.priority3 === positionName
            );
            
            if (applicants.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users-slash"></i>
                        <p>${positionName} æš‚æ— ç”³è¯·äºº</p>
                    </div>
                `;
            } else {
                container.innerHTML = `
                    <h3 style="color: #1b5e20; margin-bottom: 20px;">${positionName} ç”³è¯·äººåˆ—è¡¨ (${applicants.length}äºº)</h3>
                    ${applicants.map(app => `
                        <div class="applicant-item">
                            <div class="applicant-header">
                                <div class="applicant-name">${app.name} ${app.studentId ? `(${app.studentId})` : ''}</div>
                                <div class="applicant-priorities">
                                    ${app.priority1 === positionName ? '<span class="priority1">ç¬¬ä¸€å¿—æ„¿</span>' : ''}
                                    ${app.priority2 === positionName ? '<span>ç¬¬äºŒå¿—æ„¿</span>' : ''}
                                    ${app.priority3 === positionName ? '<span>ç¬¬ä¸‰å¿—æ„¿</span>' : ''}
                                </div>
                            </div>
                            <div class="applicant-experience">
                                <strong>ç”³è¯·ç†ç”±:</strong> ${app.experience || 'æ— '}
                            </div>
                            <div style="margin-top: 10px; font-size: 0.85rem; color: #888;">
                                æäº¤æ—¶é—´: ${formatDate(app.submittedAt)}
                            </div>
                        </div>
                    `).join('')}
                `;
            }
        }
        
        function exportData() {
            if (appData.intentions.length === 0) {
                showToast('æš‚æ— æ•°æ®å¯å¯¼å‡º', 'warning');
                return;
            }
            
            try {
                const dataForExport = appData.intentions.map(app => ({
                    å§“å: app.name,
                    å­¦å·: app.studentId || '',
                    ç­çº§: app.className || appData.currentClass.name,
                    ç¬¬ä¸€å¿—æ„¿: app.priority1 || '',
                    ç¬¬äºŒå¿—æ„¿: app.priority2 || '',
                    ç¬¬ä¸‰å¿—æ„¿: app.priority3 || '',
                    ç”³è¯·ç†ç”±: app.experience || '',
                    æäº¤æ—¶é—´: formatDate(app.submittedAt),
                    çŠ¶æ€: app.status || 'pending'
                }));
                
                const headers = Object.keys(dataForExport[0]);
                const csvRows = [
                    headers.join(','),
                    ...dataForExport.map(row => 
                        headers.map(header => {
                            const cell = row[header] || '';
                            const escaped = String(cell).replace(/"/g, '""');
                            return `"${escaped}"`;
                        }).join(',')
                    )
                ].join('\n');
                
                const blob = new Blob(['\ufeff' + csvRows], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${appData.currentClass.name}_æ„å‘æ”¶é›†_${new Date().toLocaleDateString('zh-CN')}.csv`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showToast('æ•°æ®å¯¼å‡ºæˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                showToast('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }
        
        function copyInviteLink() {
            const inviteLink = document.getElementById('inviteLink');
            inviteLink.select();
            inviteLink.setSelectionRange(0, 99999);
            
            try {
                navigator.clipboard.writeText(inviteLink.value);
                showToast('é‚€è¯·é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            } catch (error) {
                // é™çº§æ–¹æ¡ˆ
                document.execCommand('copy');
                showToast('é“¾æ¥å·²å¤åˆ¶', 'success');
            }
        }
        
        function shareClass(platform) {
            const link = document.getElementById('inviteLink').value;
            const className = appData.currentClass.name;
            
            switch (platform) {
                case 'wechat':
                    showToast('è¯·ä½¿ç”¨å¾®ä¿¡æ‰«ä¸€æ‰«åˆ†äº«äºŒç»´ç ', 'info');
                    break;
                case 'qq':
                    window.open(`https://connect.qq.com/widget/shareqq/index.html?url=${encodeURIComponent(link)}&title=${encodeURIComponent(className + ' ç­å¹²éƒ¨æ„å‘æ”¶é›†')}`);
                    break;
                case 'link':
                    copyInviteLink();
                    break;
            }
        }
        
        async function saveClassSettings() {
            if (!appData.currentUser || appData.currentUser.role !== 'teacher') {
                showToast('åªæœ‰ç­ä¸»ä»»å¯ä»¥ä¿®æ”¹è®¾ç½®', 'error');
                return;
            }
            
            const className = document.getElementById('editClassName').value.trim();
            const announcement = document.getElementById('editAnnouncement').value.trim();
            const deadline = document.getElementById('deadlineDate').value;
            
            if (!className) {
                showToast('ç­çº§åç§°ä¸èƒ½ä¸ºç©º', 'error');
                return;
            }
            
            showLoadingOverlay(true, 'ä¿å­˜è®¾ç½®...');
            
            try {
                // æ›´æ–°ç­çº§ä¿¡æ¯
                const classes = JSON.parse(localStorage.getItem('cloud_classes') || '{}');
                const classId = appData.currentUser.classId;
                
                if (classes[classId]) {
                    classes[classId].name = className;
                    
                    if (announcement) {
                        if (!classes[classId].announcements) {
                            classes[classId].announcements = [];
                        }
                        classes[classId].announcements.push({
                            content: announcement,
                            createdAt: new Date().toISOString()
                        });
                    }
                    
                    if (deadline) {
                        if (!classes[classId].settings) {
                            classes[classId].settings = {};
                        }
                        classes[classId].settings.deadline = deadline;
                    }
                    
                    localStorage.setItem('cloud_classes', JSON.stringify(classes));
                    appData.currentClass = classes[classId];
                    
                    showToast('è®¾ç½®ä¿å­˜æˆåŠŸ', 'success');
                    updateClassInfo();
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥', 'error');
                console.error(error);
            } finally {
                showLoadingOverlay(false);
            }
        }
        
        async function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newTeacherPassword').value;
            const confirmPassword = document.getElementById('confirmTeacherPassword').value;
            
            if (!currentPassword || !newPassword || !confirmPassword) {
                showToast('è¯·å¡«å†™æ‰€æœ‰å¯†ç å­—æ®µ', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showToast('ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç ä¸ä¸€è‡´', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showToast('æ–°å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½', 'error');
                return;
            }
            
            // éªŒè¯å½“å‰å¯†ç 
            if (currentPassword !== appData.currentClass.password) {
                showToast('å½“å‰å¯†ç é”™è¯¯', 'error');
                return;
            }
            
            showLoadingOverlay(true, 'ä¿®æ”¹å¯†ç ...');
            
            try {
                // æ›´æ–°å¯†ç 
                const classes = JSON.parse(localStorage.getItem('cloud_classes') || '{}');
                const classId = appData.currentUser.classId;
                
                if (classes[classId]) {
                    classes[classId].password = newPassword;
                    localStorage.setItem('cloud_classes', JSON.stringify(classes));
                    appData.currentClass = classes[classId];
                    
                    showToast('å¯†ç ä¿®æ”¹æˆåŠŸ', 'success');
                    
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('currentPassword').value = '';
                    document.getElementById('newTeacherPassword').value = '';
                    document.getElementById('confirmTeacherPassword').value = '';
                }
            } catch (error) {
                showToast('ä¿®æ”¹å¤±è´¥', 'error');
                console.error(error);
            } finally {
                showLoadingOverlay(false);
            }
        }
        
        function switchToMainInterface() {
            document.getElementById('loginPanel').classList.remove('active-panel');
            document.getElementById('mainSystem').style.display = 'block';
            
            // æ ¹æ®è§’è‰²æ˜¾ç¤ºç›¸åº”é¢æ¿
            if (appData.currentUser.role === 'teacher') {
                switchToTeacherPanel();
            } else {
                switchToStudentPanel();
            }
        }
        
        function switchToStudentPanel() {
            hideAllPanels();
            document.getElementById('studentPanel').classList.add('active-panel');
            updateActiveButton('studentBtn');
            document.getElementById('statsCard').style.display = 'block';
        }
        
        function switchToTeacherPanel() {
            hideAllPanels();
            document.getElementById('adminPanel').classList.add('active-panel');
            updateActiveButton('teacherBtn');
            document.getElementById('statsCard').style.display = 'block';
        }
        
        function switchToManagePanel() {
            if (!appData.currentUser || appData.currentUser.role !== 'teacher') {
                showToast('åªæœ‰ç­ä¸»ä»»å¯ä»¥è®¿é—®ç­çº§ç®¡ç†', 'error');
                return;
            }
            
            hideAllPanels();
            document.getElementById('managePanel').classList.add('active-panel');
            updateActiveButton('manageBtn');
            document.getElementById('statsCard').style.display = 'none';
        }
        
        function hideAllPanels() {
            document.getElementById('studentPanel').classList.remove('active-panel');
            document.getElementById('adminPanel').classList.remove('active-panel');
            document.getElementById('managePanel').classList.remove('active-panel');
        }
        
        function updateActiveButton(activeBtnId) {
            ['studentBtn', 'teacherBtn', 'manageBtn'].forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    btn.classList.remove('active');
                }
            });
            document.getElementById(activeBtnId).classList.add('active');
        }
        
        function logout() {
            if (confirm('ç¡®å®šè¦é€€å‡ºç³»ç»Ÿå—ï¼Ÿ')) {
                appData.currentUser = null;
                appData.currentClass = null;
                
                document.getElementById('mainSystem').style.display = 'none';
                document.getElementById('loginPanel').classList.add('active-panel');
                
                // é‡ç½®è¡¨å•
                document.getElementById('loginClassCode').value = '';
                document.getElementById('loginUsername').value = '';
                document.getElementById('studentId').value = '';
                document.getElementById('teacherPassword').value = '';
                
                showToast('å·²é€€å‡ºç³»ç»Ÿ', 'info');
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–é€‰é¡¹å¡
            initTabs();
            
            // ç»‘å®šäº‹ä»¶
            document.getElementById('loginUsername').addEventListener('change', function() {
                const selectedRole = this.value;
                if (selectedRole === 'student') {
                    document.getElementById('studentIdGroup').style.display = 'block';
                    document.getElementById('teacherPasswordGroup').style.display = 'none';
                } else if (selectedRole === 'teacher') {
                    document.getElementById('studentIdGroup').style.display = 'none';
                    document.getElementById('teacherPasswordGroup').style.display = 'block';
                } else {
                    document.getElementById('studentIdGroup').style.display = 'none';
                    document.getElementById('teacherPasswordGroup').style.display = 'none';
                }
            });
            
            document.getElementById('loginBtn').addEventListener('click', login);
            document.getElementById('registerBtn').addEventListener('click', registerClass);
            document.getElementById('joinBtn').addEventListener('click', joinClass);
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.getElementById('studentBtn').addEventListener('click', switchToStudentPanel);
            document.getElementById('teacherBtn').addEventListener('click', switchToTeacherPanel);
            document.getElementById('manageBtn').addEventListener('click', switchToManagePanel);
            document.getElementById('customPositionToggle').addEventListener('click', function() {
                document.getElementById('customPositionForm').classList.toggle('active');
            });
            document.getElementById('addCustomPositionBtn').addEventListener('click', addCustomPosition);
            document.getElementById('exportDataBtn').addEventListener('click', exportData);
            document.getElementById('intentionForm').addEventListener('submit', submitIntention);
            document.getElementById('saveClassSettingsBtn').addEventListener('click', saveClassSettings);
            document.getElementById('changePasswordBtn').addEventListener('click', changePassword);
            document.getElementById('generateReportBtn').addEventListener('click', function() {
                showToast('åˆ†ææŠ¥å‘Šç”Ÿæˆä¸­...', 'info');
                // è¿™é‡Œå¯ä»¥æ·»åŠ ç”ŸæˆæŠ¥å‘Šçš„é€»è¾‘
                setTimeout(() => showToast('æŠ¥å‘Šç”Ÿæˆå®Œæˆï¼', 'success'), 1500);
            });
            
            // æ£€æŸ¥URLå‚æ•°
            const urlParams = new URLSearchParams(window.location.search);
            const classCode = urlParams.get('class');
            if (classCode) {
                document.getElementById('loginClassCode').value = classCode;
                document.querySelector('[data-tab="login"]').click();
            }
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å·²ä¿å­˜çš„ç™»å½•çŠ¶æ€
            const savedUser = localStorage.getItem('currentUser');
            const savedClass = localStorage.getItem('currentClass');
            
            if (savedUser && savedClass) {
                try {
                    appData.currentUser = JSON.parse(savedUser);
                    appData.currentClass = JSON.parse(savedClass);
                    loadClassData(appData.currentUser.classId);
                } catch (error) {
                    localStorage.removeItem('currentUser');
                    localStorage.removeItem('currentClass');
                }
            }
        });
    </script>
</body>
</html>